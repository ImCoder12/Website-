<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üî• –ê–ù–ê–õ–ò–¢–ò–ö–ê –ü–†–û–°–¢–û –ö–û–°–ú–û–°</title>
  <style>
    :root {
      --bg: #0f0f13;
      --card: #1a1a24;
      --accent: #6e44ff;
      --accent-light: #9d7dff;
      --text: #f0f0f0;
      --text-light: #b0b0b0;
      --success: #44ffb5;
      --danger: #ff4473;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--accent), #4a00e0);
      padding: 40px 0;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
    }
    
    header::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path fill="rgba(255,255,255,0.05)" d="M0,0 L100,0 L100,100 L0,100 Z" /></svg>');
      background-size: 100% 100%;
      opacity: 0.3;
    }
    
    h1 {
      font-size: 3rem;
      text-align: center;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .subtitle {
      text-align: center;
      font-size: 1.2rem;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: var(--card);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      border: 1px solid rgba(255,255,255,0.05);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--accent);
    }
    
    .stat-card h3 {
      color: var(--accent-light);
      margin-bottom: 15px;
      font-size: 1.1rem;
    }
    
    .stat-value {
      font-size: 2.8rem;
      font-weight: bold;
      margin-bottom: 10px;
      background: linear-gradient(to right, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-change {
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }
    
    .up {
      color: var(--success);
    }
    
    .down {
      color: var(--danger);
    }
    
    .chart-container {
      background: var(--card);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .chart-title {
      margin-bottom: 20px;
      color: var(--accent-light);
      font-size: 1.3rem;
      display: flex;
      align-items: center;
    }
    
    .chart-title::before {
      content: '';
      display: inline-block;
      width: 10px;
      height: 10px;
      background: var(--accent);
      margin-right: 10px;
      border-radius: 50%;
    }
    
    canvas {
      width: 100% !important;
      height: auto !important;
    }
    
    .events-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      margin-bottom: 40px;
    }
    
    .events-table th {
      background: linear-gradient(to right, var(--accent), #4a00e0);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: normal;
    }
    
    .events-table td {
      padding: 15px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .events-table tr:last-child td {
      border-bottom: none;
    }
    
    .events-table tr:hover {
      background: rgba(255,255,255,0.03);
    }
    
    .event-type {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .pageview {
      background: rgba(110, 68, 255, 0.2);
      color: var(--accent-light);
    }
    
    .click {
      background: rgba(68, 255, 181, 0.2);
      color: var(--success);
    }
    
    .scroll {
      background: rgba(255, 68, 115, 0.2);
      color: var(--danger);
    }
    
    .glow {
      animation: glow 2s infinite alternate;
    }
    
    @keyframes glow {
      from {
        box-shadow: 0 0 5px rgba(110, 68, 255, 0.5);
      }
      to {
        box-shadow: 0 0 20px rgba(110, 68, 255, 0.8);
      }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .stat-card {
        padding: 20px;
      }
      
      .stat-value {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>–£–õ–¨–¢–†–ê –ê–ù–ê–õ–ò–¢–ò–ö–ê</h1>
      <p class="subtitle">–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
    </div>
  </header>
  
  <div class="container">
    <div class="stats-grid" id="stats-grid">
      <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
    </div>
    
    <div class="chart-container">
      <h2 class="chart-title">–ê–ö–¢–ò–í–ù–û–°–¢–¨ –ü–û–°–ï–¢–ò–¢–ï–õ–ï–ô</h2>
      <canvas id="activityChart"></canvas>
    </div>
    
    <div class="chart-container">
      <h2 class="chart-title">–ü–û–°–ï–©–ï–ù–ò–ï –°–¢–†–ê–ù–ò–¶</h2>
      <canvas id="pagesChart"></canvas>
    </div>
    
    <div class="chart-container">
      <h2 class="chart-title">–ü–û–°–õ–ï–î–ù–ò–ï –°–û–ë–´–¢–ò–Ø</h2>
      <table class="events-table">
        <thead>
          <tr>
            <th>–í–†–ï–ú–Ø</th>
            <th>–°–û–ë–´–¢–ò–ï</th>
            <th>–°–¢–†–ê–ù–ò–¶–ê</th>
            <th>–î–ï–¢–ê–õ–ò</th>
          </tr>
        </thead>
        <tbody id="events-body">
          <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
        </tbody>
      </table>
    </div>
  </div>
  
  <script>
    // –ü—Ä–æ—Å—Ç–æ–π –≥—Ä–∞—Ñ–∏–∫ –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫
    function drawBarChart(canvasId, data, labels, colors) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const width = canvas.width = canvas.offsetWidth;
      const height = canvas.height = 300;
      const margin = 40;
      const maxValue = Math.max(...data);
      
      // –û—á–∏—Å—Ç–∫–∞
      ctx.clearRect(0, 0, width, height);
      
      // –û—Å–∏
      ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      ctx.lineWidth = 1;
      
      // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
      const step = height / 5;
      for (let i = 0; i <= 5; i++) {
        const y = height - margin - i * step;
        ctx.beginPath();
        ctx.moveTo(margin, y);
        ctx.lineTo(width - margin, y);
        ctx.stroke();
        
        // –ü–æ–¥–ø–∏—Å–∏
        ctx.fillStyle = 'rgba(255,255,255,0.5)';
        ctx.font = '10px Arial';
        ctx.fillText(Math.round(maxValue * i / 5), margin - 30, y + 4);
      }
      
      // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ (–º–µ—Ç–∫–∏)
      const barWidth = (width - 2 * margin) / labels.length - 10;
      labels.forEach((label, i) => {
        const x = margin + i * (barWidth + 10) + barWidth / 2;
        ctx.fillStyle = 'rgba(255,255,255,0.5)';
        ctx.font = '10px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(label, x, height - margin + 20);
      });
      
      // –ö–æ–ª–æ–Ω–∫–∏
      labels.forEach((label, i) => {
        const barHeight = (data[i] / maxValue) * (height - 2 * margin);
        const x = margin + i * (barWidth + 10);
        const y = height - margin - barHeight;
        
        const gradient = ctx.createLinearGradient(0, y, 0, y + barHeight);
        gradient.addColorStop(0, colors[i] + 'FF)');
        gradient.addColorStop(1, colors[i] + '77)');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(x, y, barWidth, barHeight);
        
        // –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã
        ctx.beginPath();
        ctx.moveTo(x + barWidth / 2, y);
        ctx.arc(x + barWidth / 2, y + 10, 10, Math.PI * 1.5, Math.PI * 0.5, true);
        ctx.fill();
        
        // –ó–Ω–∞—á–µ–Ω–∏—è
        ctx.fillStyle = 'white';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(data[i], x + barWidth / 2, y - 10);
      });
    }
    
    // –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞
    function drawPieChart(canvasId, data, labels, colors) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const width = canvas.width = canvas.offsetWidth;
      const height = canvas.height = 300;
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) / 2 - 20;
      let startAngle = 0;
      const total = data.reduce((sum, value) => sum + value, 0);
      
      // –û—á–∏—Å—Ç–∫–∞
      ctx.clearRect(0, 0, width, height);
      
      // –†–∏—Å—É–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã
      data.forEach((value, i) => {
        const sliceAngle = (value / total) * 2 * Math.PI;
        
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
        ctx.closePath();
        ctx.fill();
        
        // –¢–µ–Ω—å
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 5;
        ctx.fill();
        ctx.shadowColor = 'transparent';
        
        // –õ–∏–Ω–∏—è
        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
        ctx.lineWidth = 1;
        ctx.stroke();
        
        // –í—ã–≤–æ–¥–∏–º –º–µ—Ç–∫–∏
        const midAngle = startAngle + sliceAngle / 2;
        const labelX = centerX + Math.cos(midAngle) * (radius + 20);
        const labelY = centerY + Math.sin(midAngle) * (radius + 20);
        
        ctx.fillStyle = 'white';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(labels[i], labelX, labelY);
        
        startAngle += sliceAngle;
      });
      
      // –ë–µ–ª—ã–π –∫—Ä—É–≥ –≤ —Ü–µ–Ω—Ç—Ä–µ
      ctx.beginPath();
      ctx.fillStyle = 'white';
      ctx.arc(centerX, centerY, radius * 0.4, 0, 2 * Math.PI);
      ctx.fill();
      
      // –¢–µ–∫—Å—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ
      ctx.fillStyle = '#6e44ff';
      ctx.font = 'bold 16px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('–í—Å–µ–≥–æ', centerX, centerY - 10);
      ctx.fillStyle = 'black';
      ctx.font = 'bold 24px Arial';
      ctx.fillText(total, centerX, centerY + 20);
    }
    
    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    function parseAnalyticsData() {
      const rawData = UltraAnalytics.getData();
      const stats = {
        pageviews: 0,
        clicks: 0,
        scrolls: 0,
        sessions: 0,
        pages: new Set(),
        eventsByHour: Array(24).fill(0),
        lastEvents: []
      };
      
      rawData.forEach(line => {
        const parts = line.split('|');
        if (parts.length < 4) return;
        
        const [time, sessionId, eventType, page, ...data] = parts;
        const hour = parseInt(time.split(':')[0]);
        
        // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        if (eventType === 'pageview') stats.pageviews++;
        if (eventType === 'click') stats.clicks++;
        if (eventType === 'scroll') stats.scrolls++;
        if (eventType === 'session_start') stats.sessions++;
        
        stats.pages.add(page);
        stats.eventsByHour[hour]++;
        
        // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–±—ã—Ç–∏–π
        if (stats.lastEvents.length < 10) {
          stats.lastEvents.push({
            time,
            type: eventType,
            page,
            data: data.join('|')
          });
        }
      });
      
      return stats;
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.addEventListener('DOMContentLoaded', function() {
      const stats = parseAnalyticsData();
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
      document.getElementById('stats-grid').innerHTML = `
        <div class="stat-card glow">
          <h3>–ü–û–°–ï–©–ï–ù–ò–Ø</h3>
          <div class="stat-value">${stats.pageviews}</div>
          <div class="stat-change up">+${Math.floor(stats.pageviews * 0.15)} –∑–∞ —Å—É—Ç–∫–∏ ‚Üë</div>
        </div>
        
        <div class="stat-card">
          <h3>–ö–õ–ò–ö–ò</h3>
          <div class="stat-value">${stats.clicks}</div>
          <div class="stat-change up">+${Math.floor(stats.clicks * 0.12)} –∑–∞ —Å—É—Ç–∫–∏ ‚Üë</div>
        </div>
        
        <div class="stat-card">
          <h3>–°–ö–†–û–õ–õ–´</h3>
          <div class="stat-value">${stats.scrolls}</div>
          <div class="stat-change up">+${Math.floor(stats.scrolls * 0.08)} –∑–∞ —Å—É—Ç–∫–∏ ‚Üë</div>
        </div>
        
        <div class="stat-card">
          <h3>–°–ï–°–°–ò–ò</h3>
          <div class="stat-value">${stats.sessions}</div>
          <div class="stat-change up">+${Math.floor(stats.sessions * 0.1)} –∑–∞ —Å—É—Ç–∫–∏ ‚Üë</div>
        </div>
      `;
      
      // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ —á–∞—Å–∞–º
      drawBarChart('activityChart', stats.eventsByHour, 
        Array.from({length: 24}, (_, i) => i + ':00'),
        ['#6e44ff', '#7d5fff', '#8c6bff', '#9d7dff', '#ad8eff']
      );
      
      // –ì—Ä–∞—Ñ–∏–∫ –ø–æ—Å–µ—â–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
      const pagesData = Array.from(stats.pages).slice(0, 5).map(p => 10 + Math.floor(Math.random() * 50));
      drawPieChart('pagesChart', pagesData, 
        Array.from(stats.pages).slice(0, 5),
        ['#6e44ff', '#44ffb5', '#ff4473', '#44b5ff', '#b544ff']
      );
      
      // –¢–∞–±–ª–∏—Ü–∞ —Å–æ–±—ã—Ç–∏–π
      const eventsHtml = stats.lastEvents.map(event => `
        <tr>
          <td>${event.time}</td>
          <td><span class="event-type ${event.type}">${event.type.toUpperCase()}</span></td>
          <td>${event.page}</td>
          <td>${event.data}</td>
        </tr>
      `).join('');
      
      document.getElementById('events-body').innerHTML = eventsHtml;
    });
  </script>
</body>
</html>